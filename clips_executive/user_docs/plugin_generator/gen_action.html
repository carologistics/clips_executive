<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generated ROS Action Plugin &mdash; clips_executive 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=86f27845" />

  
  
        <script src="../../_static/jquery.js?v=8dae8fb0"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=01f34227"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            clips_executive
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">CLIPS Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugin_generator/index.html">ROS Interface Plugin Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">clips_executive</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Generated ROS Action Plugin</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/user_docs/plugin_generator/gen_action.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="generated-ros-action-plugin">
<span id="configuring-srv-msgs"></span><h1>Generated ROS Action Plugin<a class="headerlink" href="#generated-ros-action-plugin" title="Link to this heading"></a></h1>
<p>Source code generated by <span class="xref std std-ref">cx_ros_comm_gen</span>.</p>
<p>Given the <em>package</em> (e.g., <code class="docutils literal notranslate"><span class="pre">example_interfaces</span></code>) and <em>action_name</em> (e.g., <code class="docutils literal notranslate"><span class="pre">Fibonacci</span></code>), this document uses the following abbreviations:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>PkgCamel</strong>: CamelCase of <em>package</em> (e.g., <code class="docutils literal notranslate"><span class="pre">ExampleInterfaces</span></code>)</p></li>
<li><p><strong>SrvCamel</strong>: CamelCase of <em>action_name</em> (e.g., <code class="docutils literal notranslate"><span class="pre">Fibonacci</span></code>)</p></li>
<li><p><strong>pkg-kebab</strong>: kebab-case of <em>package</em> (e.g., <code class="docutils literal notranslate"><span class="pre">example-interfaces</span></code>)</p></li>
<li><p><strong>action-kebab</strong>: kebab-case of <em>action_name</em> (e.g., <code class="docutils literal notranslate"><span class="pre">fibonacci</span></code>)</p></li>
</ul>
</div></blockquote>
<div class="admonition-plugin-class admonition">
<p class="admonition-title">Plugin Class</p>
<p>cx::CX<strong>PkgCamelACtionCamel</strong>Plugin</p>
<p>(e.g., cx::CXExampleInterfacesFibonacciPlugin)</p>
</div>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>This plugin has no specific configuration.</p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading"></a></h2>
<section id="facts">
<h3>Facts<a class="headerlink" href="#facts" title="Link to this heading"></a></h3>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Asserted by the respective creat-client function.</span>
<span class="c1">; Retracted by the respective destroy-client function.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-client</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server-name-string</span><span class="p">))</span>

<span class="c1">; Asserted by the respective create-server function.</span>
<span class="c1">; Retracted by the respective destroy-server function.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server</span><span class="w"> </span><span class="p">(</span><span class="nv">name</span><span class="w"> </span><span class="nv">?server-name-string</span><span class="p">))</span>

<span class="c1">; Asserted by the goal response callback of a client.</span>
<span class="c1">; Process the response and then destroy feedback.</span>
<span class="c1">; The client-goal-handle should persist until the processing of the request is fully done.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-goal-response</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server-name-string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">))</span>

<span class="c1">; Asserted by the goal feedback callback of a client.</span>
<span class="c1">; Process the response and then destroy feedback (it is read-only, do not modify it).</span>
<span class="c1">; The client-goal-handle should persist (and not be destroyed) until the processing of the goal is fully done and the action is terminated.</span>
<span class="c1">; In particular, the client goal handle pointer here will match the one from the goal-response fact.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-goal-feedback</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server-name-string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">feedback-ptr</span><span class="w"> </span><span class="nv">?f-ptr</span><span class="p">))</span>

<span class="c1">; Asserted by the goal result callback of a client.</span>
<span class="c1">; Process the result and then destroy the result pointer before retracting this fact.</span>
<span class="c1">; &quot;code&quot; is either UNKNOWN SUCCEEDED CANCELED or ABORTED.</span>
<span class="c1">; &quot;goal-id&quot; is the string representation of a uuid according to rclcpp_action::to_string().</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-wrapped-result</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server-name-string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">goal-id</span><span class="w"> </span><span class="nv">?uuid-str</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">code</span><span class="w"> </span><span class="nv">?code-symbol</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">result-ptr</span><span class="w"> </span><span class="nv">?f-ptr</span><span class="p">))</span>

<span class="c1">; Asserted by the goal result callback of a server.</span>
<span class="c1">; Process the server goal handle to retrieve important information such as the goal sent by the client.</span>
<span class="c1">; The server-goal-handle should persist (and not be destroyed) until the processing of the action is fully done and the action is terminated.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-accepted-goal</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server-name-string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">server-goal-handle-ptr</span><span class="w"> </span><span class="nv">?f-ptr</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Link to this heading"></a></h3>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Create and destroy clients and servers.</span>
<span class="c1">; After creating a server, user-defined function is called whenever a goal request arrives.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-create-server</span><span class="w"> </span><span class="nv">?server-name</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-destroy-server</span><span class="w"> </span><span class="nv">?server-name</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-create-client</span><span class="w"> </span><span class="nv">?server-name</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-destroy-client</span><span class="w"> </span><span class="nv">?server-name</span><span class="p">)</span>

<span class="c1">; Send a goal to an action server</span>
<span class="c1">; Requires the client to be created first using create-client.</span>
<span class="c1">; Callbacks will assert goal-response feedback and wrapped-result facts.</span>
<span class="c1">; Do not destroy the ?msg-ptr immediately, keep it until the goal is fully processed.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-send-goal</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?server-name</span><span class="p">)</span>

<span class="c1">; Creating, destroying and processing of goals</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-goal-create</span><span class="p">))</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-goal-destroy</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-goal-set-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="w"> </span><span class="nv">?field-value</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-goal-get-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="p">)</span>

<span class="c1">; Creating, destroying and processing of feedback</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-feedback-create</span><span class="p">))</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-feedback-destroy</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-feedback-set-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="w"> </span><span class="nv">?field-value</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-feedback-get-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="p">)</span>

<span class="c1">; Creating, destroying and processing of results</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-result-create</span><span class="p">))</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-result-destroy</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-result-set-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="w"> </span><span class="nv">?field-value</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-result-get-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="p">)</span>

<span class="c1">; Destroy server goal handle pointer.</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-destroy</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">)</span>
<span class="c1">; server goal handle members (see rclcpp_action documentation)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-abort</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="w"> </span><span class="nv">?result-ptr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-succeed</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="w"> </span><span class="nv">?result-ptr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-canceled</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="w"> </span><span class="nv">?result-ptr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?goal-ptr</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-get-goal</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="c1">; the goal id is returned as string representation via rclcpp_action::to_string()</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?uuid-str</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?bool-sym</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-is-canceling</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?bool-sym</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-is-active</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?bool-sym</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-is-executing</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-execute</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-server-goal-handle-publish-feedback</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="w"> </span><span class="nv">?feedback-ptr</span><span class="p">)</span>

<span class="c1">; client goal handle members (see rclcpp_action documentation)</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?bool-sym</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-client-goal-handle-is-feedback-aware</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?bool-sym</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-client-goal-handle-is-result-aware</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="c1">; return codes:</span>
<span class="c1">; 0 = STATUS_UNKNOWN</span>
<span class="c1">; 1 = STATUS_ACCEPTED</span>
<span class="c1">; 2 = STATUS_EXECUTING</span>
<span class="c1">; 3 = STATUS_CANCELING</span>
<span class="c1">; 4 = STATUS_SUCCEEDED</span>
<span class="c1">; 5 = STATUS_CANCELED</span>
<span class="c1">; 6 = STATUS_ABORTED</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?status-int</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-client-goal-handle-get-status</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="c1">; the goal id is returned as string representation via rclcpp_action::to_string()</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?uuid-str</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-client-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?time-seconds-float</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-client-goal-handle-get-goal-stamp</span><span class="w"> </span><span class="nv">?handle-ptr</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="functions-defined-by-user">
<h3>Functions Defined by User<a class="headerlink" href="#functions-defined-by-user" title="Link to this heading"></a></h3>
<p>The following functions are called at the appropriate places if they are defined by the user.</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Gets called for each server receiving a goal, needs to return one of these integers:</span>
<span class="c1">; (return 1) ; REJECT</span>
<span class="c1">; (return 2) ; ACCEPT_AND_EXECUTE</span>
<span class="c1">; (return 3) ; ACCEPT_AND_DEFER</span>
<span class="c1">; If the function does not exist, every goal is automatically accepted (ACCEPT_AND_EXECUTE)</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?response-int</span><span class="w"> </span><span class="p">(</span><span class="nv">&lt;package-kebab&gt;-&lt;action-kebab&gt;-handle-goal-callback</span><span class="w"> </span><span class="nv">?server-name-str</span><span class="w"> </span><span class="nv">?goal-ptr</span><span class="w"> </span><span class="nv">?uuid-str</span><span class="p">))</span>
</pre></div>
</div>
<p>; Gets called for each server receiving a cancelation request, needs to return one of these integers:
; (return 0) ; REJECT
; (return 1) ; ACCEPT
; If the function does not exist, every request is automatically accepted (ACCEPT)
(bind ?response-int (&lt;package-kebab&gt;-&lt;action-kebab&gt;-cancel-goal-callback ?server-name-str ?server-goal-handle-ptr))</p>
</section>
</section>
<section id="usage-example">
<h2>Usage Example<a class="headerlink" href="#usage-example" title="Link to this heading"></a></h2>
<p>A minimal working example is provided by the <a class="reference external" href="https://fawkesrobotics.github.io/ros2-clips-executive/cx_bringup">cx_bringup</a> package. Run it via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>cx_bringup<span class="w"> </span>cx_launch.py<span class="w"> </span>manager_config:<span class="o">=</span>plugin_examples/fibonacci_action.yaml
</pre></div>
</div>
<p>It creates a <code class="docutils literal notranslate"><span class="pre">std_srvs/srv/SetBool</span></code> service <code class="docutils literal notranslate"><span class="pre">/ros_cx_srv</span></code>. The services answers by giving the requested value in success.</p>
<p>A simple service call can be made using the ROS CLI tool:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/ros_cx_srv<span class="w"> </span>std_srvs/srv/SetBool<span class="w"> </span><span class="s2">&quot;{data: false}&quot;</span>
</pre></div>
</div>
<p>Additionally, if <code class="docutils literal notranslate"><span class="pre">true</span></code> was requested, the example makes a new request with data <code class="docutils literal notranslate"><span class="pre">true</span></code> to a service called <code class="docutils literal notranslate"><span class="pre">/ros_cx_srv_client</span></code>.
To start a simple server accepting the request, simply run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>cx_bringup<span class="w"> </span>test_service.py
</pre></div>
</div>
<section id="id1">
<h3>Configuration<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/fawkesrobotics/ros2-clips-executive/blob/master/cx_bringup/params/plugin_examples/fibonacci_action.yaml">cx_bringup/params/plugin_examples/fibonacci_action.yaml</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">clips_manager</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_fibonacci_action&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">cx_fibonacci_action</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugins</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;executive&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;files&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">log_clips_to_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;facts&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rules&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">executive</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::ExecutivePlugin&quot;</span>
<span class="w">      </span><span class="nt">publish_on_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">assert_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">refresh_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">fibonacci</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::CXExampleInterfacesFibonacciPlugin&quot;</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::FileLoadPlugin&quot;</span>
<span class="w">      </span><span class="nt">pkg_share_dirs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_bringup&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">load</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">        </span><span class="s">&quot;clips/plugin_examples/fibonacci-action.clp&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="code">
<h3>Code<a class="headerlink" href="#code" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/fawkesrobotics/ros2-clips-executive/blob/master/cx_bringup/clips/plugin_examples/fibonacci-action.clp">cx_bringup/clips/plugin_examples/fibonacci-action.clp</a>.</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">deffunction</span><span class="w"> </span><span class="nv">example-interfaces-fibonacci-handle-goal-callback</span><span class="w"> </span><span class="p">(</span><span class="nv">?server</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="nv">?uuid</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">blue</span><span class="w"> </span><span class="nv">?server</span><span class="w"> </span><span class="s">&quot; callback (goal &quot;</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="s">&quot; ; id &quot;</span><span class="w"> </span><span class="nv">?uuid</span><span class="w">  </span><span class="s">&quot; )&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="c1">; (return 1) ; REJECT</span>
<span class="w">  </span><span class="p">(</span><span class="nb">return</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">; ACCEPT_AND_EXECUTE</span>
<span class="w">  </span><span class="c1">; (return 3) ; ACCEPT_AND_DEFER</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">deffunction</span><span class="w"> </span><span class="nv">example-interfaces-fibonacci-cancel-goal-callback</span><span class="w"> </span><span class="p">(</span><span class="nv">?server</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="nv">?goal-handle</span><span class="p">)</span>
<span class="w">  </span><span class="c1">; (return 0) ; REJECT</span>
<span class="w">  </span><span class="p">(</span><span class="nb">return</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">; ACCEPT</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-action-client-server-init</span>
<span class="s">&quot; Create a simple client and service using the generated bindings. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="s">&quot;ros_cx_fibonacci&quot;</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server</span><span class="w"> </span><span class="p">(</span><span class="nv">name</span><span class="w"> </span><span class="s">&quot;ros_cx_fibonacci&quot;</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">))</span>
<span class="w">  </span><span class="c1">;(not (client-server-already-created))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="c1">;(assert (client-server-already-created))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-create-client</span><span class="w"> </span><span class="s">&quot;ros_cx_fibonacci&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Created client for /ros_cx_fibonacci&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-create-server</span><span class="w"> </span><span class="s">&quot;ros_cx_fibonacci&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Created server for /ros_cx_fibonacci&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">fibonacci</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">uuid</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">order</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">INTEGER</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">progress</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">INTEGER</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">multislot</span><span class="w"> </span><span class="nc">sequence</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">INTEGER</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">INTEGER</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">last-computed</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">FLOAT</span><span class="p">))</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-goal-accepted-start-compute</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-accepted-goal</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">server-goal-handle-ptr</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">fibonacci</span><span class="w"> </span><span class="p">(</span><span class="nv">uuid</span><span class="w"> </span><span class="nv">?uuid&amp;:</span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">?uuid</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">)))))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-is-canceling</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span><span class="w"> </span><span class="nv">then</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-get-goal</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?order</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-goal-get-field</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="s">&quot;order&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?uuid</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nv">fibonacci</span><span class="w"> </span><span class="p">(</span><span class="nv">uuid</span><span class="w"> </span><span class="nv">?uuid</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">order</span><span class="w"> </span><span class="nv">?order</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">progress</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">result</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nc">sequence</span><span class="w"> </span><span class="p">(</span><span class="nv">create$</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nv">last-computed</span><span class="w"> </span><span class="p">(</span><span class="nv">now</span><span class="p">))))</span>
<span class="w">   </span><span class="nv">else</span>
<span class="w">    </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nb">error</span><span class="w"> </span><span class="s">&quot;Somehow the goal is canceling already&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="c1">; do not destroy the server goal handle here, only do it once the goal is fully processed and finished</span>
<span class="w">  </span><span class="c1">; (example-interfaces-fibonacci-server-goal-handle-destroy ?ptr)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-compute-next</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-accepted-goal</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">server-goal-handle-ptr</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">fibonacci</span><span class="w"> </span><span class="p">(</span><span class="nv">order</span><span class="w"> </span><span class="nv">?order</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">progress</span><span class="w"> </span><span class="nv">?remaining&amp;:</span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="nv">?order</span><span class="w"> </span><span class="nv">?remaining</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">last-computed</span><span class="w"> </span><span class="nv">?computed</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">result</span><span class="w"> </span><span class="nv">?old-res</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nc">sequence</span><span class="w"> </span><span class="nv">$?seq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">uuid</span><span class="w"> </span><span class="nv">?uuid</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">time</span><span class="w"> </span><span class="nv">?now&amp;:</span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">?now</span><span class="w"> </span><span class="nv">?computed</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">test</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">?uuid</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">)))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?step</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">?remaining</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?res</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nv">nth$</span><span class="w"> </span><span class="nv">?remaining</span><span class="w"> </span><span class="nv">?seq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">nth$</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">?remaining</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">?seq</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">magenta</span><span class="w"> </span><span class="s">&quot;Computing partial result fibonacci(&quot;</span><span class="w"> </span><span class="nv">?remaining</span><span class="w"> </span><span class="s">&quot;) = &quot;</span><span class="w"> </span><span class="nv">?res</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?seq</span><span class="w"> </span><span class="p">(</span><span class="nv">create$</span><span class="w"> </span><span class="nv">?seq</span><span class="w"> </span><span class="nv">?res</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">modify</span><span class="w"> </span><span class="nv">?f</span><span class="w"> </span><span class="p">(</span><span class="nv">progress</span><span class="w"> </span><span class="nv">?step</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">result</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">?old-res</span><span class="w"> </span><span class="nv">?res</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nc">sequence</span><span class="w"> </span><span class="nv">?seq</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?feedback</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-feedback-create</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-feedback-set-field</span><span class="w"> </span><span class="nv">?feedback</span><span class="w"> </span><span class="s">&quot;sequence&quot;</span><span class="w"> </span><span class="nv">?seq</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-publish-feedback</span><span class="w"> </span><span class="nv">?ptr</span><span class="w"> </span><span class="nv">?feedback</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-feedback-destroy</span><span class="w"> </span><span class="nv">?feedback</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">modify</span><span class="w"> </span><span class="nv">?f</span><span class="w"> </span><span class="p">(</span><span class="nv">last-computed</span><span class="w"> </span><span class="nv">?now</span><span class="p">))</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-compute-done</span>
<span class="w">  </span><span class="nv">?ag</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-accepted-goal</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">server-goal-handle-ptr</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">fibonacci</span><span class="w"> </span><span class="p">(</span><span class="nv">order</span><span class="w"> </span><span class="nv">?order</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">progress</span><span class="w"> </span><span class="nv">?remaining&amp;:</span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="nv">?order</span><span class="w"> </span><span class="nv">?remaining</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nv">result</span><span class="w"> </span><span class="nv">?old-res</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nc">sequence</span><span class="w"> </span><span class="nv">$?seq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">uuid</span><span class="w"> </span><span class="nv">?uuid&amp;:</span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">?uuid</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Final fibonacci sequence (server): &quot;</span><span class="w"> </span><span class="nv">?seq</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?result</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-result-create</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-result-set-field</span><span class="w"> </span><span class="nv">?result</span><span class="w"> </span><span class="s">&quot;sequence&quot;</span><span class="w"> </span><span class="nv">?seq</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-succeed</span><span class="w"> </span><span class="nv">?ptr</span><span class="w"> </span><span class="nv">?result</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-result-destroy</span><span class="w"> </span><span class="nv">?result</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-destroy</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?f</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?ag</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-client-send-goal</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">send-request</span><span class="p">))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nv">send-request</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-goal-create</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nv">fibnoacci-goal</span><span class="w"> </span><span class="nv">?goal</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-goal-set-field</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="s">&quot;order&quot;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-send-goal</span><span class="w"> </span><span class="nv">?goal</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span>

<span class="w">  </span><span class="c1">; do not destroy the goal here, only do it once the goal is fully processed and finished</span>
<span class="w">  </span><span class="c1">; (example-interfaces-fibonacci-goal-destroy ?goal)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-client-get-feedback</span>
<span class="w">  </span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="nv">salience</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-goal-feedback</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">feedback-ptr</span><span class="w"> </span><span class="nv">?fp</span><span class="p">))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-id</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-stamp</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-get-goal-stamp</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-status</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-get-status</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-is-f-aware</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-is-feedback-aware</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-is-r-aware</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-is-result-aware</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">  </span><span class="c1">; the stamp seems to be broken (looks like a rclcpp_action issue)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">cyan</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="nv">now</span><span class="p">)</span><span class="w"> </span><span class="nv">?g-stamp</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;] &quot;</span><span class="w"> </span><span class="nv">?g-status</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="nv">?g-id</span><span class="w"> </span><span class="s">&quot; f &quot;</span><span class="w"> </span><span class="nv">?g-is-f-aware</span><span class="w"> </span><span class="s">&quot; r &quot;</span><span class="w"> </span><span class="nv">?g-is-r-aware</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?part-seq</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-feedback-get-field</span><span class="w"> </span><span class="nv">?fp</span><span class="w"> </span><span class="s">&quot;sequence&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">blue</span><span class="w"> </span><span class="s">&quot;partial sequence: &quot;</span><span class="w"> </span><span class="nv">?part-seq</span><span class="w">   </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-feedback-destroy</span><span class="w"> </span><span class="nv">?fp</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?f</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-client-cleanup-after-wrapped-result</span>
<span class="w">  </span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="nv">salience</span><span class="w"> </span><span class="mi">10</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-goal-response</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?g</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-wrapped-result</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">goal-id</span><span class="w"> </span><span class="nv">?uuid</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">code</span><span class="w"> </span><span class="nv">SUCCEEDED</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">result-ptr</span><span class="w"> </span><span class="nv">?rp</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?request-goal</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">fibnoacci-goal</span><span class="w"> </span><span class="nv">?goal</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">time</span><span class="w"> </span><span class="nv">?now</span><span class="p">)</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-status</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-get-status</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="nv">?g-status</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="nv">then</span><span class="w"> </span><span class="c1">; status is final in one way or another</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?seq</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-result-get-field</span><span class="w"> </span><span class="nv">?rp</span><span class="w"> </span><span class="s">&quot;sequence&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Final fibonacci sequence (client): &quot;</span><span class="w"> </span><span class="nv">?seq</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-result-destroy</span><span class="w"> </span><span class="nv">?rp</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?g</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-id</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-stamp</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-get-goal-stamp</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-is-f-aware</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-is-feedback-aware</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-is-r-aware</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-is-result-aware</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">cyan</span><span class="w"> </span><span class="s">&quot;Final goal response [&quot;</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="nv">now</span><span class="p">)</span><span class="w"> </span><span class="nv">?g-stamp</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;] &quot;</span><span class="w"> </span><span class="nv">?uuid</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="nv">?g-status</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="nv">?g-id</span><span class="w"> </span><span class="s">&quot; f &quot;</span><span class="w"> </span><span class="nv">?g-is-f-aware</span><span class="w"> </span><span class="s">&quot; r &quot;</span><span class="w"> </span><span class="nv">?g-is-r-aware</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-destroy</span><span class="w"> </span><span class="nv">?ghp</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?f</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-goal-destroy</span><span class="w"> </span><span class="nv">?goal</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?request-goal</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-client-server-cleanup</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?client</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server</span><span class="w"> </span><span class="p">(</span><span class="nv">name</span><span class="w"> </span><span class="nv">?server</span><span class="p">))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-destroy-client</span><span class="w"> </span><span class="nv">?client</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-destroy-server</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-goal-response-cleanup</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="nv">?f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-goal-response</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?p</span><span class="p">))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-client-goal-handle-destroy</span><span class="w"> </span><span class="nv">?p</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?f</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-accepted-goal-cleanup</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="nv">?f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-accepted-goal</span><span class="w"> </span><span class="p">(</span><span class="nv">server-goal-handle-ptr</span><span class="w"> </span><span class="nv">?p</span><span class="p">))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci-server-goal-handle-destroy</span><span class="w"> </span><span class="nv">?p</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?f</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">fibonacci-accepted-goal-cleanup</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="nv">?f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">fibnoacci-goal</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">example-interfaces-fibonacci--goal-destroy</span><span class="w"> </span><span class="nv">?p</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?f</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Tarik Viehmann.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>