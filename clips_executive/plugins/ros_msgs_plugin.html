<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generic ROS Msg Plugin &mdash; clips_executive 0.1.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=86f27845" />

  
  
        <script src="../_static/jquery.js?v=8dae8fb0"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=360bc84d"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ROS Param Plugin" href="ros_param_plugin.html" />
    <link rel="prev" title="Protobuf Plugin" href="protobuf_plugin.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            clips_executive
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">CLIPS Plugins</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#plugin-interface">Plugin Interface</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#available-plugins">Available Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cx_ament_index.html">Ament Index Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="executive_plugin.html">Continuous Execution Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="config_plugin.html">YAML Configuration Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="file_load_plugin.html">File Load Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="protobuf_plugin.html">Protobuf Plugin</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generic ROS Msg Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-example-1-publishers-and-subscribers">Usage Example 1: Publishers and Subscribers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-example-2-service-client">Usage Example 2: Service Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-example-3-service-provider">Usage Example 3: Service Provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-example-4-action-client">Usage Example 4: Action Client</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ros_param_plugin.html">ROS Param Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="tf2_pose_tracker_plugin.html">TF2 Pose Tracker Plugin</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugin_generator/index.html">ROS Interface Plugin Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../standards.html">Standard Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../__readme_include.html">README</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">clips_executive</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">CLIPS Plugins</a></li>
      <li class="breadcrumb-item active">Generic ROS Msg Plugin</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/plugins/ros_msgs_plugin.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="generic-ros-msg-plugin">
<span id="usage-ros-msgs-plugin"></span><h1>Generic ROS Msg Plugin<a class="headerlink" href="#generic-ros-msg-plugin" title="Link to this heading"></a></h1>
<p>Source code on <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_plugins/ros_msgs_plugin">GitHub</a>.</p>
<div class="admonition-plugin-class admonition">
<p class="admonition-title">Plugin Class</p>
<p>cx::RosMsgsPlugin</p>
</div>
<p>This plugin provides the ability to interface with ROS topics of any type using introspection.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>ROS introspection used to be limited to topics.
Service introspection was started in Jazzy and finished in Kilted.
Action introspection was started in Kilted and is not completed yet.
The features of this plugin vary, depending on the ROS version it is compiled with.</p>
</div>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>This plugin has no specific configuration options.</p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading"></a></h2>
<section id="facts">
<h3>Facts<a class="headerlink" href="#facts" title="Link to this heading"></a></h3>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Asserted by the create-subscription function.</span>
<span class="c1">; Retracted by the destroy-subscription function.</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-subscription</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">topic</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w"> </span><span class="c1">; example: &quot;/cx_string_in&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w">  </span><span class="c1">; example: &quot;std_msgs/msg/String&quot;</span>
<span class="p">)</span>

<span class="c1">; Asserted by the ros-msgs-create-publisher function.</span>
<span class="c1">; Retracted by the respective ros-msgs-destroy-publisher function.</span>
<span class="p">(</span><span class="nv">deftemplate-ros-msgs-publisher</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">topic</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w"> </span><span class="c1">; example: &quot;/cx_string_out&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w">  </span><span class="c1">; example: &quot;std_msgs/msg/String&quot;</span>
<span class="p">)</span>

<span class="c1">; Asserted by the callback of a subscription whenever a message arrives.</span>
<span class="c1">; Process the message and then call ros-msgs-destroy-message before retracting!</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-message</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">topic</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w">             </span><span class="c1">; example: &quot;/cx_string_in&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">msg-ptr</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">EXTERNAL-ADDRESS</span><span class="p">))</span><span class="w"> </span><span class="c1">; example: &lt;Pointer-C-0x7f1550001d20&gt;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Supported since Jazzy:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Asserted by the ros-msgs-create-client function.</span>
<span class="c1">; Retracted by the respective ros-msgs-destroy-client function.</span>
<span class="p">(</span><span class="nv">deftemplate-ros-msgs-client</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">topic</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w"> </span><span class="c1">; example: &quot;/ros_cx_client&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w">  </span><span class="c1">; example: &quot;std_srvs/srv/SetBool&quot;</span>
<span class="p">)</span>

<span class="c1">; Asserted by the callback of ros-msgs-async-send-request.</span>
<span class="c1">; Process the response like a normal message and then call</span>
<span class="c1">; ros-msgs-destroy-message before retracting!</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-response</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">service</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w">            </span><span class="c1">; example: &quot;/ros_cx_client&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">request-id</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">INTEGER</span><span class="p">))</span><span class="w">        </span><span class="c1">; example: 1</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">msg-ptr</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">EXTERNAL-ADDRESS</span><span class="p">))</span><span class="w">  </span><span class="c1">; example: &lt;Pointer-C-0x7f1550001d20&gt;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Supported since Kilted:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Asserted by the ros-msgs-create-service function.</span>
<span class="c1">; Retracted by the respective ros-msgs-destroy-service function.</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-service</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">service</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w"> </span><span class="c1">; example: &quot;/ros_cx_service&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span><span class="w">    </span><span class="c1">; example: &quot;std_srvs/srv/SetBool&quot;</span>
<span class="p">)</span>

<span class="c1">; Asserted by the ros-msgs-create-action-client function.</span>
<span class="c1">; Retracted by the respective ros-msgs-destroy-action-client function.</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-action-client</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">server</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">)))</span>
<span class="p">)</span>

<span class="c1">; Asserted by the goal response callback of ros-msgs-async-send-goal function.</span>
<span class="c1">; Process the response by using the client goal handle functions:</span>
<span class="c1">; - ros-msgs-client-goal-handle-get-goal-id</span>
<span class="c1">; - ros-msgs-client-goal-handle-get-goal-stamp</span>
<span class="c1">; Call ros-msgs-destroy-client-goal-handle before retracting.</span>
<span class="c1">; Clean up only after goal is completely handled by the server.</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-action-response</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">server</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">EXTERNAL-ADDRESS</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1">; Asserted by the goal result callback of ros-msgs-async-send-goal function.</span>
<span class="c1">; The result is a ROS message and can be processed using ros-msgs-get-field.</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-wrapped-result</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">server</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">goal-id</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">SYMBOL</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">SYMBOL</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">allowed-values</span><span class="w"> </span><span class="nv">UNKNOWN</span><span class="w"> </span><span class="nv">SUCCEEDED</span><span class="w"> </span><span class="nv">CANCELED</span><span class="w">  </span><span class="nv">ABORTED</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">result-ptr</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">EXTERNAL-ADDRESS</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1">; Asserted by the goal feedback callback of ros-msgs-async-send-goal function.</span>
<span class="c1">; The feedback is a ROS message and can be processed using ros-msgs-get-field.</span>
<span class="p">(</span><span class="nv">deftemplate</span><span class="w"> </span><span class="nv">ros-msgs-feedback</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">server</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">STRING</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">EXTERNAL-ADDRESS</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">slot</span><span class="w"> </span><span class="nv">feedback-ptr</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nv">EXTERNAL-ADDRESS</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Link to this heading"></a></h3>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Create and destroy publishers, subscribers</span>
<span class="p">(</span><span class="nv">ros-msgs-create-publisher</span><span class="w"> </span><span class="nv">?topic-name</span><span class="w"> </span><span class="nv">?msg-type</span><span class="p">)</span><span class="w">    </span><span class="c1">; example args: &quot;/cx_string_out&quot; &quot;std_msgs/msg/String&quot;</span>
<span class="p">(</span><span class="nv">ros-msgs-destroy-publisher</span><span class="w"> </span><span class="nv">?topic-name</span><span class="p">)</span><span class="w">             </span><span class="c1">; example args: &quot;/cx_string_out&quot;</span>
<span class="p">(</span><span class="nv">ros-msgs-create-subscription</span><span class="w"> </span><span class="nv">?topic-name</span><span class="w"> </span><span class="nv">?msg-type</span><span class="p">)</span><span class="w"> </span><span class="c1">; example args: &quot;/cx_string_in&quot; &quot;std_msgs/msg/String&quot;</span>
<span class="p">(</span><span class="nv">ros-msgs-destroy-subscription</span><span class="w"> </span><span class="nv">?topic-name</span><span class="p">)</span><span class="w">          </span><span class="c1">; example args: &quot;/cx_string_in&quot;</span>

<span class="c1">; Publish a given message over a topic.</span>
<span class="c1">; Requires the publisher to be created first using ros-msgs-create-publisher.</span>
<span class="p">(</span><span class="nv">ros-msgs-publish</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?topic-name</span><span class="p">)</span>

<span class="c1">; Create a message and return a pointer to it</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-message</span><span class="w"> </span><span class="nv">?msg-type</span><span class="p">))</span><span class="w"> </span><span class="c1">; example args: &quot;std_msgs/msg/String&quot;</span>
<span class="w">                                                    </span><span class="c1">; example ret: &lt;Pointer-C-0x7f1550001d20&gt;</span>

<span class="c1">; Destroy a message, call this after publishing a message or processing an incoming message to prevent it from staying in memory.</span>
<span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="p">)</span><span class="w"> </span><span class="c1">; example args: &lt;Pointer-C-0x7f1550001d20&gt;</span>

<span class="c1">; Populate the field of a message.</span>
<span class="c1">; If the field is a message, then pass a pointer to that message obtained from ros-msgs-create-message.</span>
<span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="w"> </span><span class="nv">?field-value</span><span class="p">)</span><span class="w"> </span><span class="c1">; example args: &lt;Pointer-C-0x7f1550001d20&gt; &quot;data&quot; &quot;Hello World&quot;</span>

<span class="c1">; Retrieve a field of a message.</span>
<span class="c1">; If the field is a message, then a pointer is returned that can be further inspected by passing it to ros-msgs-get-field.</span>
<span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?field-name</span><span class="p">)</span>
</pre></div>
</div>
<p>Supported since Jazzy:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Create and destroy service clients.</span>
<span class="p">(</span><span class="nv">ros-msgs-create-client</span><span class="w"> </span><span class="nv">?service-name</span><span class="w"> </span><span class="nv">?service-type</span><span class="p">)</span><span class="w"> </span><span class="c1">; example args: &quot;/ros_cx_client&quot; &quot;std_srvs/srv/SetBool&quot;</span>
<span class="p">(</span><span class="nv">ros-msgs-destroy-client</span><span class="w"> </span><span class="nv">?service-name</span><span class="p">)</span><span class="w">              </span><span class="c1">; example args: &quot;/ros_cx_client&quot;</span>

<span class="c1">; Create a request message and return a pointer to it.</span>
<span class="c1">; It is a regular message and hence can be pouplated with ros-msgs-set-field</span>
<span class="c1">; and destroyed with ros-msgs-destroy-message.</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-request</span><span class="w"> </span><span class="nv">?msg-type</span><span class="p">))</span><span class="w"> </span><span class="c1">; example args: &quot;std_srvs/srv/SetBool&quot;</span>
<span class="w">                                                    </span><span class="c1">; example ret: &lt;Pointer-C-0x7f1550001d20&gt;</span>

<span class="c1">; Send a given request message to a service.</span>
<span class="c1">; Requires the service client to be created first using ros-msgs-create-client.</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?request-id</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-async-send-request</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="nv">?service-name</span><span class="p">))</span><span class="w"> </span><span class="c1">; example args: &quot;std_srvs/srv/SetBool&quot;</span>
<span class="w">                                                                        </span><span class="c1">; example ret: 1 (or FALSE if sending the request failed)</span>
</pre></div>
</div>
<p>Supported since Kilted:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">; Create and destroy service providers.</span>
<span class="c1">; In order to answer service requests, define a function with the following signature:</span>
<span class="c1">; (deffunction &lt;service_name&gt;-service-callback (?name ?request ?response)</span>
<span class="c1">;   &lt;process request and populate response like regular ros messages&gt;</span>
<span class="c1">; )</span>
<span class="c1">; Do not cleanup the request or response, their lifetime is handled automatically.</span>
<span class="c1">;</span>
<span class="c1">; Example:</span>
<span class="c1">; (deffunction /ros_cx_service-service-callback (?name ?request ?response)</span>
<span class="c1">;   (printout green &quot;Received a request&quot; crlf)</span>
<span class="c1">;   (bind ?data (ros-msgs-get-field ?request &quot;data&quot;))</span>
<span class="c1">;   (printout yellow ?data crlf)</span>
<span class="c1">;   (ros-msgs-set-field ?response &quot;success&quot; TRUE)</span>
<span class="c1">;   (ros-msgs-set-field ?response &quot;message&quot; (str-cat &quot;Received &quot; ?data))</span>
<span class="c1">; )</span>
<span class="p">(</span><span class="nv">ros-msgs-create-service</span><span class="w"> </span><span class="nv">?service-name</span><span class="w"> </span><span class="nv">?service-type</span><span class="p">)</span><span class="w"> </span><span class="c1">; example_args: &quot;/ros_cx_service&quot; &quot;std_srvs/srv/SetBool&quot;</span>
<span class="p">(</span><span class="nv">ros-msgs-destroy-service</span><span class="w"> </span><span class="nv">?service-name</span><span class="p">)</span><span class="w">              </span><span class="c1">; example_args: &quot;/ros_cx_service&quot;</span>

<span class="c1">; Create and destroy action clients.</span>
<span class="p">(</span><span class="nv">ros-msgs-create-action-client</span><span class="w"> </span><span class="nv">?action-server</span><span class="w"> </span><span class="nv">?type</span><span class="p">)</span><span class="w"> </span><span class="c1">; eample args: &quot;fibonacci&quot; &quot;example_interfaces/action/Fibonacci&quot;</span>
<span class="p">(</span><span class="nv">ros-msgs-destroy-action-client</span><span class="w"> </span><span class="nv">?action-server</span><span class="p">)</span><span class="w"> </span><span class="c1">; example args: &quot;fibonacci&quot;</span>

<span class="c1">; Create a goal request and return a pointer to it.</span>
<span class="c1">; It is a regular message and hence can be pouplated with ros-msgs-set-field</span>
<span class="c1">; and destroyed with ros-msgs-destroy-message..</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?req-ptr</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-goal-request</span><span class="w"> </span><span class="nv">?type</span><span class="p">))</span><span class="w"> </span><span class="c1">; example args: &quot;example_interfaces/action/Fibonacci&quot;</span>
<span class="w">                                                     </span><span class="c1">; example ret: &lt;Pointer-C-0x7f1550001d20&gt;</span>

<span class="c1">; Send a goal request to an action server.</span>
<span class="c1">; This registers three callbacks: response, feedback and result.</span>
<span class="c1">; These assert the corrending facts of the following types:</span>
<span class="c1">; - ros-msgs-action-response</span>
<span class="c1">; - ros-msgs-wrapped-result</span>
<span class="c1">; - ros-msgs-feedback</span>
<span class="p">(</span><span class="nv">ros-msgs-async-send-goal</span><span class="w"> </span><span class="nv">?action-server</span><span class="w"> </span><span class="nv">?req-ptr</span><span class="p">)</span><span class="w"> </span><span class="c1">; example args: &quot;fibonacci&quot; &lt;Pointer-C-0x7f1550001d20&gt;</span>

<span class="c1">; Functions to inspect client goal handles that are contained in the facts asserted by action callbacks.</span>

<span class="c1">; Uses rclcpp_action::to_string to provide a formatted version of the associated goal id (as SYMBOL).</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-id</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-client-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?client-goal-handle-ptr</span><span class="p">))</span><span class="w"> </span><span class="c1">; example args: &lt;Pointer-C-0x7f1550001d20&gt;</span>
<span class="w">                                                        </span><span class="c1">; example ret: f2d1cd46-58f2-5bfe-d49f-e182c4a4eccc</span>

<span class="c1">; Provide the goal stamp using get_goal_stamp().seconds()</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?ts</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-client-goal-handle-get-goal-stamp</span><span class="w"> </span><span class="nv">?client-goal-handle-ptr</span><span class="p">))</span><span class="w"> </span><span class="c1">; example args: &lt;Pointer-C-0x7f1550001d20&gt;</span>
<span class="w">                                                                                </span><span class="c1">; example ret: 1698326401.123456</span>

<span class="c1">; Delete a client goal handle. Use this only after the associated goal is fully processed.</span>
<span class="p">(</span><span class="nv">ros-msgs-destroy-client-goal-handle</span><span class="w"> </span><span class="nv">?client-goal-handle-ptr</span><span class="p">)</span><span class="w"> </span><span class="c1">; example args: &lt;Pointer-C-0x7f1550001d20&gt;</span>
</pre></div>
</div>
</section>
<section id="message-lifetimes">
<h3>Message Lifetimes<a class="headerlink" href="#message-lifetimes" title="Link to this heading"></a></h3>
<p>Since clips stores objects via void pointers, dynamic object lifetime management via <cite>std::shared_ptr</cite> does not work directly from within CLIPS.
Instead, object lifetimes need to be managed more explicitly through the usage of <cite>create</cite> and <cite>destroy</cite> functions.</p>
<p>It is advised to clean up all objects as soon as they are not needed anymore in order to free up memory.</p>
<p>Note that when processing nested messages, the message obtained via <strong>ros-msgs-get-field</strong> is not allocating new memory, but rather points to the memory of the parent message.
Calling <strong>ros-msgs-destroy-message</strong> is not necessary, as sub-messages retrieved via <strong>ros-msgs-get-field</strong> only hold a shallow reference and are cleaned up when the parent message is destroyed. Calling it anyways, will only invalidate this shallow reference.</p>
<p>When creating a new message via <strong>ros-msgs-create-message</strong>, new memory is allocated.
When using <strong>ros-msgs-set-field</strong> to set a nested message, dynamic memory from the sub-message is moved to the parent message, hence the nested message loses all dynamically allocated data (e.g., unbound arrays, strings).
See the example below:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?new-msg</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-message</span><span class="w"> </span><span class="s">&quot;geometry_msgs/msg/Twist&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?sub-msg</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-message</span><span class="w"> </span><span class="s">&quot;geometry_msgs/msg/Vector3&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?sub-msg</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
<span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?new-msg</span><span class="w"> </span><span class="s">&quot;linear&quot;</span><span class="w"> </span><span class="nv">?sub-msg</span><span class="p">)</span>
<span class="c1">; now all dynamicly allocated members of ?sub-msg are reset,</span>
<span class="c1">; as they are moved to the parent message.</span>
</pre></div>
</div>
<p>In particular, obtaining a nested message from one message <code class="docutils literal notranslate"><span class="pre">?source</span></code> and setting it as a member to another message <code class="docutils literal notranslate"><span class="pre">?sink</span></code> will cause <code class="docutils literal notranslate"><span class="pre">?source</span></code> to lose all dynamic data within it’s sub-message, as the sub-message obtained is actually pointing to memory within <code class="docutils literal notranslate"><span class="pre">?source</span></code>:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?source</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-message</span><span class="w"> </span><span class="s">&quot;geometry_msgs/msg/Twist&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?sub-msg</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-message</span><span class="w"> </span><span class="s">&quot;geometry_msgs/msg/Vector3&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?sub-msg</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="mf">5.5</span><span class="p">)</span>
<span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?source</span><span class="w"> </span><span class="s">&quot;linear&quot;</span><span class="w"> </span><span class="nv">?sub-msg</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?sink</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-message</span><span class="w"> </span><span class="s">&quot;geometry_msgs/msg/Twist&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?source-sub-msg</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?source</span><span class="w"> </span><span class="s">&quot;linear&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?sink</span><span class="w"> </span><span class="s">&quot;linear&quot;</span><span class="w"> </span><span class="nv">?source-sub-msg</span><span class="p">)</span>
<span class="c1">; now all dynamicly allocated members of the sub message in ?source are reset,</span>
<span class="c1">; as they are moved to ?sink.</span>
</pre></div>
</div>
</section>
<section id="action-lifetime">
<h3>Action Lifetime<a class="headerlink" href="#action-lifetime" title="Link to this heading"></a></h3>
<p>When dealing with actions, always make sure to keep the relevant goal handles alive for the entire duration of the associated action. Do not attempt to preemptively delete it. The same goes for goal requests.</p>
</section>
</section>
<section id="usage-example-1-publishers-and-subscribers">
<h2>Usage Example 1: Publishers and Subscribers<a class="headerlink" href="#usage-example-1-publishers-and-subscribers" title="Link to this heading"></a></h2>
<p>A minimal working example is provided by the <a class="reference external" href="https://carologistics.github.io/clips-executive/cx_bringup">cx_bringup</a> package. Run it via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>cx_bringup<span class="w"> </span>cx_launch.py<span class="w"> </span>manager_config:<span class="o">=</span>plugin_examples/ros_msgs.yaml
</pre></div>
</div>
<p>It creates a <code class="docutils literal notranslate"><span class="pre">std_msgs/msg/String</span></code> subscription on topic <code class="docutils literal notranslate"><span class="pre">/ros_cx_in</span></code> and prints out any text send over it.
Additionally, it creates a publisher on <code class="docutils literal notranslate"><span class="pre">/ros_cx_out</span></code> that publishes <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World</span></code> whenever something is received over the <code class="docutils literal notranslate"><span class="pre">/ros_cx_in</span></code> topic.</p>
<section id="id1">
<h3>Configuration<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/params/plugin_examples/ros_msgs.yaml">cx_bringup/params/plugin_examples/ros_msgs.yaml</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">clips_manager</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_ros_msgs&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">cx_ros_msgs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugins</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;executive&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ros_msgs&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;files&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;facts&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rules&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">executive</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::ExecutivePlugin&quot;</span>
<span class="w">      </span><span class="nt">refresh_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">ros_msgs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::RosMsgsPlugin&quot;</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::FileLoadPlugin&quot;</span>
<span class="w">      </span><span class="nt">pkg_share_dirs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_bringup&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">load</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">        </span><span class="s">&quot;clips/plugin_examples/ros-msgs.clp&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="code">
<h3>Code<a class="headerlink" href="#code" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/clips/plugin_examples/ros-msgs.clp">cx_bringup/clips/plugin_examples/ros-msgs.clp</a>.</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-pub-init</span>
<span class="s">&quot; Create publisher for ros_cx_out.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-publisher</span><span class="w"> </span><span class="p">(</span><span class="nv">topic</span><span class="w"> </span><span class="s">&quot;ros_cx_out&quot;</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="c1">; create the publisher</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-create-publisher</span><span class="w"> </span><span class="s">&quot;ros_cx_out&quot;</span><span class="w"> </span><span class="s">&quot;std_msgs/msg/String&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Publishing on /ros_cx_out&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-pub-hello</span>
<span class="s">&quot; Whenever a message comes in, send out a Hello World message in response. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="nv">salience</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-publisher</span><span class="w"> </span><span class="p">(</span><span class="nv">topic</span><span class="w"> </span><span class="nv">?topic</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-message</span><span class="p">)</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">yellow</span><span class="w"> </span><span class="s">&quot;Sending Hello World Message!&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?msg</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-message</span><span class="w"> </span><span class="s">&quot;std_msgs/msg/String&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?msg</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="s">&quot;Hello world!&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-publish</span><span class="w"> </span><span class="nv">?msg</span><span class="w"> </span><span class="nv">?topic</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?msg</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-sub-init</span>
<span class="s">&quot; Create a simple subscriber using the generated bindings. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-subscription</span><span class="w"> </span><span class="p">(</span><span class="nv">topic</span><span class="w"> </span><span class="s">&quot;ros_cx_in&quot;</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-create-subscription</span><span class="w"> </span><span class="s">&quot;ros_cx_in&quot;</span><span class="w"> </span><span class="s">&quot;std_msgs/msg/String&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Listening for String messages on /ros_cx_in&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-receive</span>
<span class="s">&quot; React to incoming messages and answer (on a different topic). &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-subscription</span><span class="w"> </span><span class="p">(</span><span class="nv">topic</span><span class="w"> </span><span class="nv">?sub</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?msg-f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-message</span><span class="w"> </span><span class="p">(</span><span class="nv">topic</span><span class="w"> </span><span class="nv">?sub</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">msg-ptr</span><span class="w"> </span><span class="nv">?inc-msg</span><span class="p">))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?recv</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?inc-msg</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">blue</span><span class="w"> </span><span class="s">&quot;Recieved via &quot;</span><span class="w"> </span><span class="nv">?sub</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="nv">?recv</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?inc-msg</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?msg-f</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-pub-sub-finalize</span>
<span class="s">&quot; Delete the publisher and subscription on executive finalize. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-publisher</span><span class="w"> </span><span class="p">(</span><span class="nv">topic</span><span class="w"> </span><span class="nv">?topic</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-subscription</span><span class="w"> </span><span class="p">(</span><span class="nv">topic</span><span class="w"> </span><span class="nv">?in-topic</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Destroying publishers and subscriptions &quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-publisher</span><span class="w"> </span><span class="nv">?topic</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-subscription</span><span class="w"> </span><span class="nv">?in-topic</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-message-cleanup</span>
<span class="s">&quot; Delete the messages on executive finalize. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="nv">?msg-f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-message</span><span class="w"> </span><span class="p">(</span><span class="nv">msg-ptr</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?msg-f</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="usage-example-2-service-client">
<h2>Usage Example 2: Service Client<a class="headerlink" href="#usage-example-2-service-client" title="Link to this heading"></a></h2>
<p>This example requires ROS jazzy or later.</p>
<p>A minimal working example is provided by the <a class="reference external" href="https://carologistics.github.io/clips-executive/cx_bringup">cx_bringup</a> package. Run it via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>cx_bringup<span class="w"> </span>cx_launch.py<span class="w"> </span>manager_config:<span class="o">=</span>plugin_examples/ros_msgs_client.yaml
</pre></div>
</div>
<p>It creates a <code class="docutils literal notranslate"><span class="pre">std_srvs/srv/SetBool</span></code> client for <code class="docutils literal notranslate"><span class="pre">/ros_cx_client</span></code>, sends a request and prints the response.</p>
<p>In order to launch a simple service to send the request to, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>cx_bringup<span class="w"> </span>test_service.py
</pre></div>
</div>
<section id="id2">
<h3>Configuration<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/params/plugin_examples/ros_msgs_client.yaml">cx_bringup/params/plugin_examples/ros_msgs_client.yaml</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">clips_manager</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_ros_msgs_client&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">cx_ros_msgs_client</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugins</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;executive&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ros_msgs&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;files&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;facts&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rules&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">executive</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::ExecutivePlugin&quot;</span>
<span class="w">      </span><span class="nt">refresh_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">ros_msgs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::RosMsgsPlugin&quot;</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::FileLoadPlugin&quot;</span>
<span class="w">      </span><span class="nt">pkg_share_dirs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_bringup&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">load</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">        </span><span class="s">&quot;clips/plugin_examples/ros-msgs-client.clp&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Code<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/clips/plugin_examples/ros-msgs.clp">cx_bringup/clips/plugin_examples/ros-msgs.clp</a>.</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-client-init</span>
<span class="s">&quot; Create publisher for ros_cx_out.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-client</span><span class="w"> </span><span class="p">(</span><span class="nv">service</span><span class="w"> </span><span class="s">&quot;ros_cx_client&quot;</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="c1">; create the publisher</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-create-client</span><span class="w"> </span><span class="s">&quot;ros_cx_client&quot;</span><span class="w"> </span><span class="s">&quot;std_srvs/srv/SetBool&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Opening client on /ros_cx_client&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-request-true</span>
<span class="s">&quot; Attempt to request the service. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-client</span><span class="w"> </span><span class="p">(</span><span class="nv">service</span><span class="w"> </span><span class="nv">?service</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">request</span><span class="w"> </span><span class="nv">?any-id</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">time</span><span class="w"> </span><span class="nv">?any-time</span><span class="p">)</span><span class="w"> </span><span class="c1">; used to continuously attempt to request the service until success</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?new-req</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-request</span><span class="w"> </span><span class="s">&quot;std_srvs/srv/SetBool&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?new-req</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="nv">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?id</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-async-send-request</span><span class="w"> </span><span class="nv">?new-req</span><span class="w"> </span><span class="nv">?service</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">?id</span><span class="w"> </span><span class="nv">then</span>
<span class="w">    </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">yellow</span><span class="w"> </span><span class="s">&quot;Request sent with id &quot;</span><span class="w"> </span><span class="nv">?id</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nv">request</span><span class="w"> </span><span class="nv">?id</span><span class="p">))</span>
<span class="w">   </span><span class="nv">else</span>
<span class="w">    </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">red</span><span class="w"> </span><span class="s">&quot;Sending of request failed, is the service running?&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">red</span><span class="w"> </span><span class="s">&quot;Start it using \&quot;ros2 run cx_bringup test_service.py\&quot;&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?new-req</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">set-bool-client-response-received</span>
<span class="s">&quot; Get response, read it and delete.&quot;</span>
<span class="w">  </span><span class="nv">?msg-fact</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-response</span><span class="w"> </span><span class="p">(</span><span class="nv">service</span><span class="w"> </span><span class="nv">?service</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">msg-ptr</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">request-id</span><span class="w"> </span><span class="nv">?id</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">request</span><span class="w"> </span><span class="nv">?id</span><span class="p">)</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?succ</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?ptr</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?msg</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?ptr</span><span class="w"> </span><span class="s">&quot;message&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Received response from &quot;</span><span class="w"> </span><span class="nv">?service</span><span class="w"> </span><span class="s">&quot; with: &quot;</span><span class="w"> </span><span class="nv">?succ</span><span class="w"> </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="nv">?msg</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?msg-fact</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-client-finalize</span>
<span class="s">&quot; Delete the client on executive finalize. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-client</span><span class="w"> </span><span class="p">(</span><span class="nv">service</span><span class="w"> </span><span class="nv">?service</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Destroying client&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-client</span><span class="w"> </span><span class="nv">?service</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-message-cleanup</span>
<span class="s">&quot; Delete the messages on executive finalize. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="nv">?msg-f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-message</span><span class="w"> </span><span class="p">(</span><span class="nv">msg-ptr</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?msg-f</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="usage-example-3-service-provider">
<h2>Usage Example 3: Service Provider<a class="headerlink" href="#usage-example-3-service-provider" title="Link to this heading"></a></h2>
<p>This example requires ROS kilted or later.</p>
<p>A minimal working example is provided by the <a class="reference external" href="https://carologistics.github.io/clips-executive/cx_bringup">cx_bringup</a> package. Run it via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>cx_bringup<span class="w"> </span>cx_launch.py<span class="w"> </span>manager_config:<span class="o">=</span>plugin_examples/ros_msgs_service.yaml
</pre></div>
</div>
<p>It creates a <code class="docutils literal notranslate"><span class="pre">std_srvs/srv/SetBool</span></code> service <code class="docutils literal notranslate"><span class="pre">/ros_cx_service</span></code> and prints all requests, returning successfully and adding a message with the request.</p>
<p>In order to launch a simple client to send the request, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/ros_cx_service<span class="w"> </span>std_srvs/srv/SetBool<span class="w"> </span><span class="s2">&quot;{data: true}&quot;</span>
</pre></div>
</div>
<section id="id4">
<h3>Configuration<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/params/plugin_examples/ros_msgs_service.yaml">cx_bringup/params/plugin_examples/ros_msgs_service.yaml</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">/**</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_ros_msgs_service&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">cx_ros_msgs_service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugins</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;executive&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ros_msgs&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;files&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">log_clips_to_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;facts&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rules&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">executive</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::ExecutivePlugin&quot;</span>
<span class="w">      </span><span class="nt">publish_on_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">assert_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">refresh_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">ros_msgs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::RosMsgsPlugin&quot;</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::FileLoadPlugin&quot;</span>
<span class="w">      </span><span class="nt">pkg_share_dirs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_bringup&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">load</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">        </span><span class="s">&quot;clips/plugin_examples/ros-msgs-service.clp&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3>Code<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/clips/plugin_examples/ros-msgs-service.clp">cx_bringup/clips/plugin_examples/ros-msgs-service.clp</a>.</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-service-init</span>
<span class="s">&quot; Create a service /ros_cx_service&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-service</span><span class="w"> </span><span class="p">(</span><span class="nv">service</span><span class="w"> </span><span class="s">&quot;ros_cx_service&quot;</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-create-service</span><span class="w"> </span><span class="s">&quot;ros_cx_service&quot;</span><span class="w"> </span><span class="s">&quot;std_srvs/srv/SetBool&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Opening service on /ros_cx_service&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Call it via &#39;ros2 service call /ros_cx_service std_srvs/srv/SetBool \&quot;{data: true}\&quot;&quot;</span><span class="o">&#39;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">deffunction</span><span class="w"> </span><span class="nv">ros_cx_service-service-callback</span><span class="w"> </span><span class="p">(</span><span class="nv">?name</span><span class="w"> </span><span class="nv">?request</span><span class="w"> </span><span class="nv">?response</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Received a request&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?data</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?request</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">yellow</span><span class="w"> </span><span class="nv">?data</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?response</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="w"> </span><span class="nv">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?response</span><span class="w"> </span><span class="s">&quot;message&quot;</span><span class="w"> </span><span class="p">(</span><span class="nv">str-cat</span><span class="w"> </span><span class="s">&quot;Received &quot;</span><span class="w"> </span><span class="nv">?data</span><span class="p">))</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-service-finalize</span>
<span class="s">&quot; Delete the service on executive finalize. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-service</span><span class="w"> </span><span class="p">(</span><span class="nv">service</span><span class="w"> </span><span class="nv">?service</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Destroying service&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-service</span><span class="w"> </span><span class="nv">?service</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="usage-example-4-action-client">
<h2>Usage Example 4: Action Client<a class="headerlink" href="#usage-example-4-action-client" title="Link to this heading"></a></h2>
<p>This example requires ROS kilted or later.</p>
<p>A minimal working example is provided by the <a class="reference external" href="https://carologistics.github.io/clips-executive/cx_bringup">cx_bringup</a> package. Run it via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>cx_bringup<span class="w"> </span>cx_launch.py<span class="w"> </span>manager_config:<span class="o">=</span>plugin_examples/ros_msgs_action_client.yaml
</pre></div>
</div>
<p>It creates an action client <code class="docutils literal notranslate"><span class="pre">/fibonacci</span></code> (of type <code class="docutils literal notranslate"><span class="pre">example_interfaces/action/Fibonacci</span></code>) and requests the fibonacci sequence of order 10.</p>
<p>In order to launch the corresponding server, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>action_tutorials_cpp<span class="w"> </span>fibonacci_action_server
</pre></div>
</div>
<section id="id6">
<h3>Configuration<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/params/plugin_examples/ros_msgs_action_client.yaml">cx_bringup/params/plugin_examples/ros_msgs_action_client.yaml</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">/**</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_ros_msgs_action_client&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">cx_ros_msgs_action_client</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugins</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;executive&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ros_msgs&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;files&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">log_clips_to_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;facts&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rules&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">executive</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::ExecutivePlugin&quot;</span>
<span class="w">      </span><span class="nt">publish_on_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">assert_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">refresh_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">ros_msgs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::RosMsgsPlugin&quot;</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cx::FileLoadPlugin&quot;</span>
<span class="w">      </span><span class="nt">pkg_share_dirs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;cx_bringup&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">load</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">        </span><span class="s">&quot;clips/plugin_examples/ros-msgs-action-client.clp&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3>Code<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>File <a class="reference external" href="https://github.com/carologistics/clips-executive/blob/master/cx_bringup/clips/plugin_examples/ros-msgs-action-client.clp">cx_bringup/clips/plugin_examples/ros-msgs-action-client.clp</a>.</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-action-client-init</span>
<span class="s">&quot; Create a client for fibonacci example action server.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-action-client</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-create-action-client</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="w"> </span><span class="s">&quot;example_interfaces/action/Fibonacci&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Opening client on /fibonacci&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;Run a corresponding server using &#39;ros2 run action_tutorials_cpp fibonacci_action_server&#39;&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-action-client-send-goal</span>
<span class="s">&quot; Send a goal request for the 10th fibonacci number. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-action-client</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">request</span><span class="w"> </span><span class="nv">?</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">already-requested</span><span class="p">))</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?new-req</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-create-goal-request</span><span class="w"> </span><span class="s">&quot;example_interfaces/action/Fibonacci&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-set-field</span><span class="w"> </span><span class="nv">?new-req</span><span class="w"> </span><span class="s">&quot;order&quot;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?val</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?new-req</span><span class="w"> </span><span class="s">&quot;order&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">blue</span><span class="w"> </span><span class="s">&quot;i have this value: &quot;</span><span class="w"> </span><span class="nv">?val</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?id</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-async-send-goal</span><span class="w"> </span><span class="nv">?new-req</span><span class="w"> </span><span class="nv">?server</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nv">request</span><span class="w"> </span><span class="nv">?new-req</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="nv">already-requested</span><span class="p">))</span>
<span class="w">  </span><span class="c1">; do not destroy goal directly, it is kept alive</span>
<span class="w">  </span><span class="c1">;(ros-msgs-destroy-message ?new-req)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-action-client-check-client-goal-handle</span>
<span class="s">&quot; Process the response for the requested goal.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-action-response</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?g-id</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-client-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?stamp</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-client-goal-handle-get-goal-stamp</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="s">&quot;goal id &quot;</span><span class="w"> </span><span class="nv">?g-id</span><span class="w"> </span><span class="s">&quot; at stamp &quot;</span><span class="w"> </span><span class="nv">?stamp</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-action-client-read-feedback</span>
<span class="w"> </span><span class="nv">?fact</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-feedback</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">feedback-ptr</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?seq</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="w"> </span><span class="s">&quot;sequence&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">yellow</span><span class="w"> </span><span class="s">&quot;partial sequence &quot;</span><span class="w"> </span><span class="nv">?seq</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?msg-ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?fact</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-action-client-process-result</span>
<span class="w">  </span><span class="nv">?response-f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-action-response</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">client-goal-handle-ptr</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">))</span>
<span class="w">  </span><span class="nv">?result-f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-wrapped-result</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">goal-id</span><span class="w"> </span><span class="nv">?id</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">code</span><span class="w"> </span><span class="nv">?code</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">result-ptr</span><span class="w"> </span><span class="nv">?res-ptr</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">test</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">?id</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-client-goal-handle-get-goal-id</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">)))</span>
<span class="w">  </span><span class="nv">?req-f</span><span class="w"> </span><span class="nv">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">request</span><span class="w"> </span><span class="nv">?req-ptr</span><span class="p">)</span>
<span class="w">  </span><span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Action result: &quot;</span><span class="w"> </span><span class="nv">?code</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">?code</span><span class="w"> </span><span class="nv">SUCCEEDED</span><span class="p">)</span>
<span class="w">    </span><span class="nv">then</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bind</span><span class="w"> </span><span class="nv">?result</span><span class="w"> </span><span class="p">(</span><span class="nv">ros-msgs-get-field</span><span class="w"> </span><span class="nv">?res-ptr</span><span class="w"> </span><span class="s">&quot;sequence&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="s">&quot;fibonacci sequence of order 10 is: &quot;</span><span class="w"> </span><span class="nv">?result</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?res-ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-message</span><span class="w"> </span><span class="nv">?req-ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-client-goal-handle</span><span class="w"> </span><span class="nv">?cgh-ptr</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retract</span><span class="w"> </span><span class="nv">?response-f</span><span class="w"> </span><span class="nv">?result-f</span><span class="w"> </span><span class="nv">?req-f</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">defrule</span><span class="w"> </span><span class="nv">ros-msgs-action-client-finalize</span>
<span class="s">&quot; Delete the client on executive finalize. &quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">executive-finalize</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-action-client</span><span class="w"> </span><span class="p">(</span><span class="nv">server</span><span class="w"> </span><span class="nv">?server</span><span class="p">))</span>
<span class="nv">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nv">printout</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="s">&quot;Destroying action client&quot;</span><span class="w"> </span><span class="nv">crlf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">ros-msgs-destroy-action-client</span><span class="w"> </span><span class="nv">?server</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="protobuf_plugin.html" class="btn btn-neutral float-left" title="Protobuf Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ros_param_plugin.html" class="btn btn-neutral float-right" title="ROS Param Plugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Tarik Viehmann.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>